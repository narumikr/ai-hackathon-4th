# API Testing Tool

Historical Travel Agent APIの開発・デバッグを支援するStreamlitベースのAPI検証ツールです。

## 概要

このツールは、開発者がブラウザ上でAPIエンドポイントを選択し、パラメータを入力してリクエストを実行し、レスポンスを確認できるインタラクティブなツールです。

## 機能

- ✅ エンドポイント選択機能
- ✅ パスパラメータ、クエリパラメータ、リクエストボディの入力
- ✅ JSONリクエストボディのサンプル表示
- ✅ ファイルアップロード（multipart/form-data）
- ✅ HTTPレスポンスの表示（ステータスコード、ボディ、ヘッダー）
- ✅ エラーハンドリング
- ✅ ベースURL設定（環境変数またはUI）

## セットアップ

### 1. 仮想環境の作成

```bash
uv venv
```

### 2. 依存パッケージのインストール

```bash
uv pip install -r requirements.txt
```

### 3. 環境変数の設定（オプション）

`.env`ファイルを作成して、ベースURLを設定できます：

```bash
API_BASE_URL=http://localhost:8000
```

環境変数が設定されていない場合は、デフォルトの`http://localhost:8000`が使用されます。

## 使用方法

### 1. アプリケーションの起動

仮想環境をアクティベートしてから、Streamlitアプリケーションを起動します：

```bash
# 仮想環境をアクティベート
source .venv/bin/activate

# アプリケーションを起動
streamlit run app.py
```

ブラウザが自動的に開き、`http://localhost:8501`でアプリケーションにアクセスできます。

**注意**: 初回起動時は、Streamlitがメールアドレスの入力を求める場合がありますが、Enterキーを押してスキップできます。

### 2. エンドポイントの選択

サイドバーから、テストしたいAPIエンドポイントを選択します。

利用可能なエンドポイント：
- **旅行計画**: 作成、一覧取得、取得、更新、削除
- **旅行ガイド**: 生成
- **振り返り**: 生成
- **スポット振り返り**: 写真登録
- **ヘルスチェック**: ルート、ヘルスチェック

### 3. パラメータの入力

選択したエンドポイントに応じて、必要なパラメータを入力します：

- **パスパラメータ**: エンドポイントパスに含まれるパラメータ（例: `plan_id`）
- **クエリパラメータ**: URLクエリ文字列のパラメータ（例: `user_id`）
- **リクエストボディ**: JSON形式のリクエストボディ（サンプル表示機能付き）
- **ファイルアップロード**: 画像ファイルのアップロード（スポット振り返りAPI用）

### 4. リクエストの実行

「🚀 リクエストを実行」ボタンをクリックして、APIリクエストを送信します。

### 5. レスポンスの確認

レスポンスエリアに以下の情報が表示されます：

- **ステータスコード**: HTTPステータスコード（色分け表示）
  - 🟢 2xx: 成功
  - 🟡 4xx: クライアントエラー
  - 🔴 5xx: サーバーエラー
- **レスポンスボディ**: JSON整形表示またはテキスト表示
- **レスポンスヘッダー**: 折りたたみ可能なヘッダー情報

## プロジェクト構造

```
develop/api_testing/
├── app.py                      # Streamlitアプリケーションのメインエントリーポイント
├── api_client.py               # APIクライアント実装
├── models.py                   # データモデル定義
├── endpoints.py                # エンドポイント定義
├── ui/
│   ├── __init__.py
│   ├── endpoint_selector.py   # エンドポイント選択UI
│   ├── request_builder.py     # リクエストフォームUI
│   ├── response_viewer.py     # レスポンス表示UI
│   └── settings.py            # 設定パネルUI
├── requirements.txt           # 依存パッケージ
├── README.md                  # このファイル
└── .gitignore                 # Git除外設定

```

## 依存パッケージ

- `streamlit>=1.30.0`: Webアプリケーションフレームワーク
- `requests>=2.31.0`: HTTPクライアント
- `python-dotenv>=1.0.0`: 環境変数管理

## トラブルシューティング

### バックエンドAPIに接続できない

- バックエンドAPIが起動しているか確認してください
- ベースURLが正しいか確認してください（サイドバーで変更可能）
- ファイアウォールやネットワーク設定を確認してください

### JSONパースエラー

- リクエストボディが有効なJSON形式か確認してください
- サンプル表示ボタンを使用して、正しい形式を確認してください

### ファイルアップロードエラー

- ファイル形式がサポートされているか確認してください（jpg, jpeg, png, gif）
- ファイルサイズが大きすぎないか確認してください

## 開発者向け情報

### コードフォーマット

```bash
source .venv/bin/activate
ruff format .
```

### コードチェック

```bash
source .venv/bin/activate
ruff check .
```

### 型チェック

```bash
source .venv/bin/activate
pyright .
```

## ライセンス

このツールは開発・デバッグ用途に限定されています。
