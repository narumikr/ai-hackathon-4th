<context>
あなたは、歴史学習特化型旅行の振り返りパンフレットを生成するタスクを担当しています。
ユーザーが実際に体験した旅行の情報（旅行前の計画・ガイド情報と、旅行後の写真・コメント）を統合し、思い出と学びを想起させる振り返りパンフレットを作成してください。
</context>

<before_trip>
## 旅行前情報

### 基本情報
- 旅行タイトル: {travel_title}
- 旅行先: {destination}

### 観光スポット
{spots_text}

### 旅行ガイド概要
{guide_overview}

### 年表
{timeline_text}

### スポット詳細
{spot_detail_text}

### チェックポイント
{checkpoint_text}
</before_trip>

<after_trip>
## 旅行後情報

### 写真分析
{photo_text}
※ 上記が「なし」「認識不可」「不明」など写真内容を特定できない情報のみの場合、写真情報は利用不可として扱うこと。

### ユーザーの総合感想
{user_notes_text}

### スポットごとの感想
{spot_notes_text}
</after_trip>

<task>
## タスク

上記の旅行前情報と旅行後情報を統合し、振り返りパンフレットを生成してください。
</task>

<thinking_process>
## 思考プロセス

以下のステップに従って、段階的に振り返りパンフレットを生成してください。

### ステップ1: 情報統合
1. 旅行前情報（計画、ガイド、年表、スポット詳細、チェックポイント）を確認する
2. 旅行後情報（写真分析、ユーザーコメント）を確認する
3. 各スポットについて、以下を統合する:
   - スポット名（旅行計画と完全に一致させること）
   - 写真のanalysisとuserDescription
   - ユーザーのスポットごとの感想
   - 旅行ガイドの歴史情報（年表、スポット詳細、チェックポイント）

### ステップ2: 分析
1. 写真から読み取れる具体的な描写を抽出する
2. ユーザーコメントから体験の具体性を抽出する
3. 歴史的知識と実体験の結びつきを特定する
4. 五感に訴える要素（見たもの、感じたこと、雰囲気）を特定する
5. 印象深い場面や瞬間を特定する

### ステップ3: 執筆
1. travelSummary: 旅行全体の印象を、写真/コメントの具体的引用を含めて執筆する
2. spotReflections: 各スポットについて、写真の具体描写、体験の引用、歴史的知識との結びつき、五感描写を含めて執筆する
3. nextTripSuggestions: 今回の体験と学びを踏まえた次回旅行の提案を執筆する
</thinking_process>

<constraints>
## 制約条件（MUST）

### 文字数制約（厳守）
- **travelSummary**: 240〜360文字の範囲内に収めること（REQUIRED）
- **spotReflections**: 各スポット160〜260文字の範囲内に収めること（REQUIRED）
- **nextTripSuggestions**: 2〜4件を提案すること（REQUIRED）

### 内容の優先順位
1. **最優先**: 写真のanalysisとuserDescription、ユーザーの総合感想、スポットごとの感想を具体的に引用すること
2. 各スポットのreflectionには、写真から読み取れる具体的な描写とユーザーコメントに基づく体験描写を必ず含めること
3. 各スポットのreflectionに「この写真から、ユーザーは〇〇を体験したことがわかる」という形式の一文を含めること

### 条件付きルール（写真情報の可用性）
- 写真分析が利用不可（「なし」「認識不可」「不明」など）の場合、travelSummaryおよびspotReflectionsで**写真への言及を禁止**すること。
- 写真分析が利用可能なスポットのみ、写真に基づく描写を含めてよい。
- 利用不可の写真情報を根拠として推測・補完しないこと。

### 構成方針
- 印象深い場面や瞬間を物語的に構成し、時系列や場所の流れに沿って思い出しやすく書くこと
- 旅行ガイドの年表、スポット詳細、チェックポイントと実際の体験を結びつけること
- 五感に訴える描写（見たもの、感じたこと、雰囲気）を含めること

### 禁止事項
- **入力情報にない事実は絶対に作らないこと**（CRITICAL）
- スポット名を変更・省略しないこと（旅行計画と完全に一致させること）
- 推測や想像で情報を補完しないこと
</constraints>

<examples>
## 良い例

### travelSummary の例
```
京都の歴史を五感で体感する旅でした。金閣寺では、写真に映る鏡のような水面に映る金色の楼閣に圧倒され、室町時代の美意識を実感しました。清水寺では、舞台から眺めた京都の街並みと紅葉の美しさに感動し、平安時代の人々もこの景色を愛したことを想像しました。八坂神社では、朱色の楼門をくぐると厳かな雰囲気に包まれ、古くから続く祇園祭の伝統を肌で感じました。歴史の教科書で学んだ知識が、実際の場所で生きた体験として蘇る、かけがえのない旅でした。
```

### spotReflection の例
```
金閣寺では、写真に映る鏡のような水面に映る金色の楼閣の美しさに圧倒されました。この写真から、晴天の下で金箔が輝く様子を実際に目にしたことがわかります。「想像以上に金色が鮮やかで、水面に映る姿が神秘的だった」というコメント通り、室町時代の足利義満が目指した極楽浄土の世界観を五感で体験できました。庭園を歩きながら、禅宗文化と武家文化が融合した北山文化の美意識を実感し、歴史の教科書で学んだ知識が生きた体験として蘇りました。
```
</examples>

<response_schema>
## 出力形式

必ず以下のJSONスキーマに厳密に準拠したJSON形式で出力してください。
JSON以外の説明文や追加テキストは一切含めないでください。

```json
{{
  "travelSummary": "string (240〜360文字)",
  "spotReflections": [
    {{
      "spotName": "string (旅行計画と完全一致)",
      "reflection": "string (160〜260文字)"
    }}
  ],
  "nextTripSuggestions": [
    {{
      "destination": "string",
      "reason": "string"
    }}
  ]
}}
```
</response_schema>
