# タイムラインスタイルレイアウト構造設計書（Timeline-Style Layout）

## 概要

歴史学習特化型旅行AIエージェントシステムのタイムラインスタイルレイアウト設計。時系列を軸にした縦スクロール型のストーリーテリングで、歴史の流れを直感的に体験できるインターフェース。

## デザインコンセプト

### キーワード

- **時間軸**: 歴史を時系列で体験
- **ストーリーフロー**: 上から下への自然な流れ
- **没入型スクロール**: 無限スクロールの快適さ
- **ビジュアル重視**: 大きな画像と動画

### インスピレーション

- **Instagram/Facebook**: 縦スクロールフィード
- **Medium**: 読書に最適化された縦スクロール
- **Apple製品ページ**: スクロール連動の演出
- **歴史年表**: 時系列の可視化

## 全体レイアウト構造

### 1. タイムラインハブ（Timeline Hub）- ホーム画面

ホーム画面は縦に流れるタイムライン。各旅行が時系列で表示される。

```
┌─────────────────────────────────────┐
│  [Minimal Header]                   │
├─────────────────────────────────────┤
│                                     │
│  Historical Travel Agent            │
│  あなたの歴史旅行タイムライン        │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 2026年2月                    │   │
│  │ ┌─────────────────────────┐ │   │
│  │ │ [Image]                 │ │   │
│  │ │ 京都の歴史旅行           │ │   │
│  │ │ 2月15日〜17日            │ │   │
│  │ └─────────────────────────┘ │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 2026年1月                    │   │
│  │ ┌─────────────────────────┐ │   │
│  │ │ [Image]                 │ │   │
│  │ │ 大阪の歴史旅行           │ │   │
│  │ │ 1月20日〜22日            │ │   │
│  │ └─────────────────────────┘ │   │
│  └─────────────────────────────┘   │
│                                     │
│  ↓ スクロールで続きを見る            │
└─────────────────────────────────────┘
```


#### タイムラインカードの特徴

- **月別グループ**: 同じ月の旅行をグループ化
- **カードデザイン**: 大きな画像 + タイトル + 日付
- **ホバー効果**: 軽い拡大とシャドウ強化
- **無限スクロール**: 過去の旅行を遡れる

### 2. 旅行詳細タイムライン（Travel Detail Timeline）

各旅行の詳細は、縦スクロールのストーリーとして展開。

```
┌─────────────────────────────────────┐
│  [Floating Header - 最小化]         │
├─────────────────────────────────────┤
│                                     │
│  [Hero Image - Full Width]          │
│                                     │
│  京都の歴史旅行                      │
│  2026年2月15日〜17日                 │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ━━━ 旅の概要 ━━━                  │
│                                     │
│  京都は794年に平安京として創建され... │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ━━━ 歴史年表 ━━━                  │
│                                     │
│  ┌─ 794年                          │
│  │  平安京遷都                      │
│  │  [小さな画像]                    │
│  │                                 │
│  ┌─ 1467年                         │
│  │  応仁の乱                        │
│  │  [小さな画像]                    │
│  │                                 │
│  ┌─ 1868年                         │
│  │  明治維新                        │
│  │  [小さな画像]                    │
│  │                                 │
├─────────────────────────────────────┤
│                                     │
│  ━━━ 観光スポット ━━━              │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [Large Image]                │   │
│  │                              │   │
│  │ 清水寺                        │   │
│  │ 778年創建の歴史ある寺院       │   │
│  │                              │   │
│  │ [詳細を見る]                  │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [Large Image]                │   │
│  │                              │   │
│  │ 金閣寺                        │   │
│  │ 室町時代の代表的建築物        │   │
│  │                              │   │
│  │ [詳細を見る]                  │   │
│  └─────────────────────────────┘   │
│                                     │
│  ↓ スクロールで続きを見る            │
└─────────────────────────────────────┘
```

#### セクション構成

1. **ヒーロー**: フルワイド画像 + タイトル
2. **概要**: テキスト中心
3. **年表**: 縦タイムライン
4. **スポット**: カード型、大きな画像
5. **チェックポイント**: リスト形式

### 3. スクロール連動プログレスバー

読書進捗を視覚化。

```
┌─────────────────────────────────────┐
│  [Header]                           │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │ ← プログレスバー
├─────────────────────────────────────┤
│                                     │
│  [Content]                          │
│                                     │
└─────────────────────────────────────┘
```

#### プログレスバーの特徴

- **位置**: ヘッダー下部
- **色**: プライマリカラー
- **高さ**: 2〜3px
- **アニメーション**: スムーズな伸縮

### 4. スティッキーナビゲーション

スクロール中も常にアクセス可能なナビゲーション。

```
┌─────────────────────────────────────┐
│  [Logo] [概要|年表|スポット] [Menu]  │ ← スティッキー
├─────────────────────────────────────┤
│                                     │
│  [Content - スクロール可能]          │
│                                     │
└─────────────────────────────────────┘
```

#### ナビゲーション機能

- **セクションリンク**: クリックでスムーズスクロール
- **アクティブ表示**: 現在のセクションをハイライト
- **スクロールスパイ**: 自動的にアクティブ更新

### 5. 無限スクロール vs ページネーション

#### 無限スクロール（推奨）

```
┌─────────────────────────────────────┐
│  [Content 1]                        │
│  [Content 2]                        │
│  [Content 3]                        │
│  [Loading...]                       │ ← 自動ロード
│  [Content 4]                        │
│  [Content 5]                        │
└─────────────────────────────────────┘
```

- **利点**: シームレスな体験
- **欠点**: フッターに到達しにくい

#### ページネーション（代替案）

```
┌─────────────────────────────────────┐
│  [Content 1]                        │
│  [Content 2]                        │
│  [Content 3]                        │
│                                     │
│  [もっと見る]                        │
└─────────────────────────────────────┘
```

- **利点**: ユーザーがコントロール
- **欠点**: クリックが必要

### 6. スクロール連動アニメーション

要素が画面に入ったらアニメーション。

```
[スクロール前]
┌─────────────────────────────────────┐
│                                     │
│  [見えている要素]                    │
│                                     │
│  ─────────────────────────────────  │ ← 画面下端
│                                     │
│  [まだ見えない要素]                  │ ← 透明度0%
│                                     │
└─────────────────────────────────────┘

[スクロール後]
┌─────────────────────────────────────┐
│                                     │
│  [見えている要素]                    │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  [表示された要素]                    │ ← フェードイン
│                                     │
└─────────────────────────────────────┘
```

#### アニメーションパターン

1. **フェードイン**: 透明度 0 → 1
2. **スライドアップ**: Y軸 +20px → 0
3. **スケールイン**: scale 0.95 → 1
4. **スタガー**: 順番に表示

## ページレイアウトパターン

### パターン1: フルワイドヒーロー

```
┌─────────────────────────────────────┐
│                                     │
│                                     │
│  [Full Width Hero Image]            │
│                                     │
│  タイトル                            │
│  サブタイトル                        │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

### パターン2: テキスト + 画像（左右配置）

```
┌─────────────────────────────────────┐
│  ┌──────────┐  ┌──────────────┐    │
│  │          │  │              │    │
│  │  Image   │  │  Text        │    │
│  │          │  │  Content     │    │
│  │          │  │              │    │
│  └──────────┘  └──────────────┘    │
└─────────────────────────────────────┘
```

### パターン3: カードグリッド

```
┌─────────────────────────────────────┐
│  ┌──────────┐  ┌──────────┐        │
│  │  Card 1  │  │  Card 2  │        │
│  └──────────┘  └──────────┘        │
│                                     │
│  ┌──────────┐  ┌──────────┐        │
│  │  Card 3  │  │  Card 4  │        │
│  └──────────┘  └──────────┘        │
└─────────────────────────────────────┘
```

### パターン4: 縦タイムライン

```
┌─────────────────────────────────────┐
│  ┌─ 794年                           │
│  │  平安京遷都                       │
│  │  [Image]                         │
│  │                                  │
│  ┌─ 1467年                          │
│  │  応仁の乱                         │
│  │  [Image]                         │
│  │                                  │
│  ┌─ 1868年                          │
│  │  明治維新                         │
│  │  [Image]                         │
└─────────────────────────────────────┘
```

### パターン5: 引用・コラム

```
┌─────────────────────────────────────┐
│                                     │
│  ┌─────────────────────────────┐   │
│  │ "歴史は繰り返す"             │   │
│  │                             │   │
│  │ - 歴史家                     │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

## インタラクション設計

### 1. スムーズスクロール

セクションリンクをクリックすると、該当セクションへスムーズにスクロール。

```typescript
const scrollToSection = (sectionId: string) => {
  const element = document.getElementById(sectionId);
  element?.scrollIntoView({ 
    behavior: 'smooth',
    block: 'start'
  });
};
```

### 2. スクロールスパイ

現在表示中のセクションをナビゲーションでハイライト。

```typescript
const useScrollSpy = (sectionIds: string[]) => {
  const [activeSection, setActiveSection] = useState('');
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveSection(entry.target.id);
          }
        });
      },
      { threshold: 0.5 }
    );
    
    sectionIds.forEach((id) => {
      const element = document.getElementById(id);
      if (element) observer.observe(element);
    });
    
    return () => observer.disconnect();
  }, [sectionIds]);
  
  return activeSection;
};
```

### 3. 「トップへ戻る」ボタン

スクロールダウンすると表示されるボタン。

```
┌─────────────────────────────────────┐
│                                     │
│  [Content]                          │
│                                     │
│                          ┌────┐    │
│                          │ ↑  │    │ ← 右下に固定
│                          └────┘    │
└─────────────────────────────────────┘
```

#### 表示条件

- スクロール位置が300px以上で表示
- フェードイン/アウトアニメーション
- クリックでトップへスムーズスクロール

### 4. 読書進捗の保存

ユーザーがどこまで読んだかを記憶。

```typescript
const saveReadingProgress = (travelId: string, scrollPosition: number) => {
  localStorage.setItem(
    `reading-progress-${travelId}`,
    JSON.stringify({
      position: scrollPosition,
      timestamp: Date.now(),
    })
  );
};

const restoreReadingProgress = (travelId: string) => {
  const saved = localStorage.getItem(`reading-progress-${travelId}`);
  if (saved) {
    const { position } = JSON.parse(saved);
    window.scrollTo({ top: position, behavior: 'smooth' });
  }
};
```

## レスポンシブ対応

### デスクトップ（1024px以上）

- **コンテンツ幅**: 最大1280px、中央寄せ
- **画像**: 大きく表示
- **2カラムレイアウト**: テキスト + 画像

### タブレット（768px〜1023px）

- **コンテンツ幅**: 最大768px
- **画像**: 中サイズ
- **1カラムレイアウト**: 縦積み

### モバイル（〜767px）

- **コンテンツ幅**: 画面幅の95%
- **画像**: 小サイズ
- **1カラムレイアウト**: 縦積み
- **フォント**: やや小さめ

## パフォーマンス最適化

### 1. 遅延ローディング

画面外の画像は遅延ローディング。

```tsx
<Image
  src="/image.jpg"
  alt="Description"
  loading="lazy"
  width={800}
  height={600}
/>
```

### 2. 仮想スクロール

大量のアイテムがある場合は仮想スクロール。

```tsx
import { useVirtualizer } from '@tanstack/react-virtual';

const virtualizer = useVirtualizer({
  count: items.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 200,
});
```

### 3. Intersection Observer

要素の表示検知に使用。

```tsx
const useInView = (ref: RefObject<HTMLElement>) => {
  const [isInView, setIsInView] = useState(false);
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => setIsInView(entry.isIntersecting),
      { threshold: 0.1 }
    );
    
    if (ref.current) {
      observer.observe(ref.current);
    }
    
    return () => observer.disconnect();
  }, [ref]);
  
  return isInView;
};
```

## 実装技術

### スクロールライブラリ

1. **React Scroll** (推奨)
   - スムーズスクロール
   - スクロールスパイ
   - 軽量

```tsx
import { Link, Element } from 'react-scroll';

<Link to="section1" smooth={true} duration={500}>
  セクション1へ
</Link>

<Element name="section1">
  <div>セクション1の内容</div>
</Element>
```

2. **Framer Motion**
   - スクロール連動アニメーション
   - 高度な制御

```tsx
import { motion, useScroll, useTransform } from 'framer-motion';

const { scrollYProgress } = useScroll();
const opacity = useTransform(scrollYProgress, [0, 1], [1, 0]);

<motion.div style={{ opacity }}>
  Content
</motion.div>
```

### アニメーションライブラリ

1. **AOS (Animate On Scroll)**
   - シンプル
   - 設定が簡単

```tsx
import AOS from 'aos';
import 'aos/dist/aos.css';

useEffect(() => {
  AOS.init({ duration: 1000 });
}, []);

<div data-aos="fade-up">
  Content
</div>
```

2. **Framer Motion**
   - React専用
   - 高度な制御

```tsx
<motion.div
  initial={{ opacity: 0, y: 20 }}
  whileInView={{ opacity: 1, y: 0 }}
  viewport={{ once: true }}
  transition={{ duration: 0.5 }}
>
  Content
</motion.div>
```

## 実装ファイル構成

```
frontend/src/
├── app/
│   └── (timeline)/
│       ├── layout.tsx              # タイムラインレイアウト
│       ├── page.tsx                # タイムラインハブ
│       └── travel/
│           └── [id]/
│               └── page.tsx        # 旅行詳細タイムライン
├── components/
│   ├── timeline/
│   │   ├── TimelineHub.tsx         # タイムラインハブ
│   │   ├── TimelineCard.tsx        # タイムラインカード
│   │   ├── TravelTimeline.tsx      # 旅行詳細タイムライン
│   │   ├── ProgressBar.tsx         # プログレスバー
│   │   ├── StickyNav.tsx           # スティッキーナビ
│   │   ├── ScrollToTop.tsx         # トップへ戻るボタン
│   │   └── TimelineSection.tsx     # タイムラインセクション
│   └── ui/
│       └── ...
├── hooks/
│   ├── useScrollSpy.ts             # スクロールスパイ
│   ├── useInView.ts                # Intersection Observer
│   ├── useScrollProgress.ts        # スクロール進捗
│   └── useReadingProgress.ts       # 読書進捗管理
└── styles/
    └── timeline.css                # タイムライン専用スタイル
```

## 実装優先度

### Phase 1（基本機能）

1. タイムラインハブ（ホーム画面）
2. 旅行詳細タイムライン
3. スムーズスクロール
4. プログレスバー

### Phase 2（インタラクション）

1. スクロールスパイ
2. スティッキーナビゲーション
3. トップへ戻るボタン
4. スクロール連動アニメーション

### Phase 3（機能拡張）

1. 無限スクロール
2. 読書進捗保存
3. 仮想スクロール（大量データ対応）
4. パフォーマンス最適化

## 利点と課題

### 利点

- **直感的**: 縦スクロールは慣れた操作
- **没入感**: 途切れないストーリー体験
- **モバイル最適**: スマホでの操作が快適
- **実装容易**: 標準的なWebパターン

### 課題

- **長いページ**: 全体像が把握しにくい
- **パフォーマンス**: 大量コンテンツで重くなる
- **ナビゲーション**: 特定セクションへのアクセス
- **SEO**: 単一ページになりがち

### 解決策

- **目次**: スティッキーナビで解決
- **遅延ローディング**: パフォーマンス改善
- **スクロールスパイ**: 現在位置を明示
- **SSR**: Next.jsで対応

## 比較: 標準 vs モダン vs ブック vs タイムライン

| 項目 | 標準 | モダン | ブック | タイムライン |
|------|------|--------|--------|-------------|
| スクロール | 縦 | 縦+横 | ページめくり | 縦（無限） |
| ナビゲーション | 固定ヘッダー | フローティング | 目次 | スティッキー |
| 没入感 | 中 | 高 | 高 | 中〜高 |
| 実装難易度 | 低 | 中〜高 | 高 | 低〜中 |
| モバイル対応 | 良 | 良 | 中 | 優 |
| パフォーマンス | 高 | 中 | 中 | 中〜高 |
| ユニーク性 | 低 | 高 | 非常に高 | 中 |

## 推奨事項

### タイムラインを推奨する場面

- **コンテンツ量**: 中〜大量
- **ストーリー性**: 時系列の流れが重要
- **デバイス**: モバイルファースト
- **開発期間**: 中期間
- **ターゲット**: 幅広い年齢層

### 他のレイアウトを推奨する場面

- **標準**: 短期間、確実性重視
- **モダン**: ビジュアル重視、若年層
- **ブック**: 教育的、ユニーク性重視

## 次のステップ

1. **プロトタイプ作成**: Figmaでモックアップ
2. **ユーザーテスト**: スクロール体験の評価
3. **パフォーマンステスト**: 大量コンテンツでテスト
4. **段階的実装**: Phase 1から順次実装
