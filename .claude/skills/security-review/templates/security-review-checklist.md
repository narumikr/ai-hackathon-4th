# セキュリティレビュー チェックリスト

## レビュー情報

| 項目 | 内容 |
|------|------|
| レビュー対象 | [対象システム/機能名] |
| レビュー種別 | [ ] 実装レビュー / [ ] 設計レビュー / [ ] 要件レビュー |
| レビュー日 | YYYY-MM-DD |
| レビュアー | [名前] |
| 対象言語/FW | [例: Python/FastAPI] |

---

## 1. 入力処理

### 1.1 入力バリデーション

- [ ] すべての外部入力にバリデーションを実装しているか
- [ ] サーバーサイドでバリデーションを実施しているか（クライアントサイドのみに依存していないか）
- [ ] ホワイトリスト方式を採用しているか
- [ ] 入力の型、長さ、範囲、形式を検証しているか

### 1.2 インジェクション対策

- [ ] SQLインジェクション: パラメータ化クエリまたはORMを使用しているか
- [ ] XSS: 出力時にHTMLエスケープを行っているか
- [ ] OSコマンドインジェクション: ユーザー入力をコマンドに含めていないか
- [ ] テンプレートインジェクション: ユーザー入力をテンプレートとして解釈していないか
- [ ] LDAPインジェクション: LDAP操作でユーザー入力をエスケープしているか

### 1.3 ファイル処理

- [ ] ファイルアップロード: サイズ、拡張子、MIMEタイプを検証しているか
- [ ] パストラバーサル: ファイルパス構築時にディレクトリ境界を検証しているか
- [ ] ファイル名: ユーザー提供のファイル名をサニタイズしているか

---

## 2. 認証

### 2.1 認証方式

- [ ] 適切な認証方式を使用しているか（JWT、OAuth 2.0、Session等）
- [ ] すべてのエンドポイントで認証が実装されているか（公開APIを除く）
- [ ] 認証の迂回が不可能であることを確認しているか

### 2.2 パスワード管理

- [ ] パスワードはbcrypt/argon2でハッシュ化して保存しているか
- [ ] パスワードポリシーは適切か（最小12文字、複雑性要件）
- [ ] パスワードリセット機能は安全か（時間制限付きトークン）

### 2.3 セッション/トークン管理

- [ ] セッションIDは暗号学的に安全な乱数で生成しているか
- [ ] セッションに適切な有効期限を設定しているか
- [ ] ログアウト時にセッションを無効化しているか
- [ ] ログイン成功時にセッションIDを再生成しているか
- [ ] JWTのアルゴリズムを明示的に指定しているか
- [ ] JWTの有効期限は短く設定されているか

### 2.4 ブルートフォース対策

- [ ] アカウントロックアウト/レート制限を実装しているか
- [ ] 認証失敗をログに記録しているか
- [ ] 認証エラーメッセージが情報を漏洩していないか

---

## 3. 認可

### 3.1 アクセス制御

- [ ] すべてのリソースアクセスで認可チェックを実施しているか
- [ ] リソース所有者チェック（IDOR防止）を実施しているか
- [ ] 管理者機能へのアクセス制御は適切か
- [ ] デフォルト拒否の方針を採用しているか
- [ ] サーバーサイドで認可判定を行っているか

### 3.2 権限管理

- [ ] 最小権限の原則を適用しているか
- [ ] 垂直権限昇格（一般ユーザー→管理者）を防止しているか
- [ ] 水平権限昇格（他ユーザーのリソースへのアクセス）を防止しているか

---

## 4. データ保護

### 4.1 機密データの取り扱い

- [ ] 機密データ（パスワード、トークン等）をレスポンスに含めていないか
- [ ] エラーメッセージに内部情報を露出していないか
- [ ] ログに機密情報を出力していないか
- [ ] 機密データを必要最小限の期間のみ保持しているか

### 4.2 暗号化

- [ ] 通信はHTTPS/TLSで暗号化されているか
- [ ] 保存時に暗号化が必要なデータは暗号化されているか
- [ ] 暗号化キーは安全に管理されているか
- [ ] 弱い暗号アルゴリズム（MD5、SHA-1）を使用していないか

### 4.3 シークレット管理

- [ ] シークレットをソースコードにハードコーディングしていないか
- [ ] `.env`ファイルを`.gitignore`に追加しているか
- [ ] 環境変数または シークレットマネージャーを使用しているか

---

## 5. セキュリティ設定

### 5.1 アプリケーション設定

- [ ] デバッグモードは本番環境で無効化されているか
- [ ] 不要なエンドポイント/機能が無効化されているか
- [ ] デフォルト認証情報を変更しているか

### 5.2 HTTPヘッダー

- [ ] `Strict-Transport-Security`（HSTS）を設定しているか
- [ ] `X-Content-Type-Options: nosniff`を設定しているか
- [ ] `X-Frame-Options: DENY`を設定しているか
- [ ] `Content-Security-Policy`を設定しているか
- [ ] `Referrer-Policy`を設定しているか

### 5.3 CORS

- [ ] 本番環境でオリジンを限定しているか（`*`を使用していないか）
- [ ] `allow_credentials=True`の場合、ワイルドカードオリジンを使用していないか
- [ ] 不要なHTTPメソッドを許可していないか

### 5.4 レート制限

- [ ] 重要なエンドポイント（ログイン、登録等）にレート制限を設定しているか
- [ ] レート制限超過時に適切なレスポンス（429）を返しているか

---

## 6. 依存関係

- [ ] 依存ライブラリに既知の脆弱性がないか（`pip-audit`, `npm audit`等で確認）
- [ ] ロックファイル（`poetry.lock`, `package-lock.json`等）が管理されているか
- [ ] 不要な依存ライブラリを削除しているか
- [ ] サポート切れのライブラリを使用していないか
- [ ] 依存関係の自動更新の仕組みがあるか（Dependabot等）

---

## 7. ロギング・モニタリング

- [ ] 認証成功・失敗をログに記録しているか
- [ ] 認可失敗をログに記録しているか
- [ ] 重要な操作（削除、設定変更等）をログに記録しているか
- [ ] ログに機密情報を含めていないか
- [ ] 異常検知の仕組みがあるか
- [ ] ログの改ざん防止策はあるか

---

## 8. エラーハンドリング

- [ ] 例外を適切にハンドリングしているか（フェイルクローズ）
- [ ] エラー時にスタックトレースを返していないか
- [ ] エラー時にアクセスを許可していないか（フェイルオープンの回避）
- [ ] 一貫したエラーレスポンス形式を使用しているか

---

## 発見事項

### Critical（即座に対応が必要）

| # | 問題 | 場所 | OWASP | 説明 | 対策 |
|---|------|------|-------|------|------|
| 1 | | | | | |

### High（次のリリースまでに対応）

| # | 問題 | 場所 | OWASP | 説明 | 対策 |
|---|------|------|-------|------|------|
| 1 | | | | | |

### Medium（計画的に対応）

| # | 問題 | 場所 | OWASP | 説明 | 対策 |
|---|------|------|-------|------|------|
| 1 | | | | | |

### Low（余裕がある時に対応）

| # | 問題 | 場所 | OWASP | 説明 | 対策 |
|---|------|------|-------|------|------|
| 1 | | | | | |

---

## 総合評価

| 評価項目 | 評価 |
|----------|------|
| 全体評価 | [ ] 合格 / [ ] 条件付き合格 / [ ] 不合格 |
| Critical件数 | 0件 |
| High件数 | 0件 |
| Medium件数 | 0件 |
| Low件数 | 0件 |

### コメント

[総合的な評価コメントを記載]

### 次のアクション

- [ ] Critical/Highの問題を修正
- [ ] 修正後に再レビューを実施
- [ ] セキュリティテストを実施
