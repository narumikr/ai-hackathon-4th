# コアテクニック詳細

このファイルでは、プロンプトエンジニアリングのコアテクニックを詳細に解説する。

## 1. 明確で直接的な指示

### 原則

曖昧さは誤解を招き、望まない出力につながる。具体的で直接的な指示は、モデルが正確に期待される動作を理解するために不可欠である。

### 詳細なガイドライン

#### 具体的なアクション動詞を使用

- **良い例**: 「抽出」「分類」「要約」「変換」「検証」
- **悪い例**: 「処理」「扱う」「見る」

#### 出力形式を明示

```
悪い例:
ユーザーデータを整理してください
良い例:
以下の形式でユーザーデータを整理してください:
- 名前: フルネーム（姓 名）
- Email: 小文字に正規化
- 登録日: YYYY-MM-DD形式
- ステータス: active/inactive/suspended のいずれか
```

#### 判断基準を明確化

```
悪い例:
重要なイベントを抽出してください

良い例:
以下の基準でイベントを抽出してください:
- 参加者が100名以上
- 予算が100万円以上
- または、CEOが参加するイベント
```

#### スコープと制約を定義

```
良い例:
最新100件のログから、エラーレベルのメッセージのみを抽出し、
発生時刻の降順でソートしてください。最大20件まで出力してください。
```

### 実践例

#### Before (曖昧な指示)

```
このコードをレビューしてください
```

#### After (明確な指示)

```
以下のPythonコードをレビューし、以下の観点から改善点を指摘してください:

1. セキュリティ: SQLインジェクション、XSS、認証/認可の問題
2. パフォーマンス: N+1問題、不要なループ、非効率なデータ構造
3. 可読性: 命名規則、コメント、関数の長さ
4. エラーハンドリング: 例外処理、エッジケース

各改善点について:
- 問題箇所の行番号
- 問題の説明
- 具体的な改善案
を提示してください。
```

## 2. 例の使用（Few-shot Learning）

### 原則

適切な例を提供することで、モデルは期待される出力形式とパターンを正確に理解できる。例は「見本」として機能する。

### 詳細なガイドライン

#### 適切な例の数

- **Zero-shot**: 例なし（明確な指示のみで十分な場合）
- **One-shot**: 1例（シンプルなタスク）
- **Few-shot**: 2-5例（推奨、多様性をカバー）
- **Many-shot**: 6例以上（複雑な分類や微妙な違いがある場合）

#### 例の品質

高品質な例の特徴:
- **代表性**: タスクの典型的なケースをカバー
- **多様性**: エッジケースや異なるパターンを含む
- **正確性**: 期待される出力の完璧な見本
- **明確性**: 入力と出力の関係が明確

#### 例の構造

```
良い例の形式:

タスク説明: [何をするか]

例1:
入力: [具体的な入力]
出力: [期待される出力]
理由: [なぜこの出力か - オプション]

例2:
入力: [別のケース]
出力: [期待される出力]
理由: [説明 - オプション]

実際のタスク:
入力: [処理する入力]
出力:
```

### 実践例

#### タスク: 感情分析

```
以下の形式でテキストの感情を分類してください:

例1:
入力: "この製品は素晴らしい!期待以上でした。"
出力: {"sentiment": "positive", "confidence": "high", "keywords": ["素晴らしい", "期待以上"]}

例2:
入力: "普通です。特に良くも悪くもない。"
出力: {"sentiment": "neutral", "confidence": "high", "keywords": ["普通", "良くも悪くもない"]}

例3:
入力: "最悪です。二度と買いません。"
出力: {"sentiment": "negative", "confidence": "high", "keywords": ["最悪", "二度と買いません"]}

例4:
入力: "価格は高いけど、品質は良いかな。"
出力: {"sentiment": "mixed", "confidence": "medium", "keywords": ["価格は高い", "品質は良い"]}

実際のタスク:
入力: "配送は早かったけど、商品に傷がありました。"
出力:
```

## 3. 思考プロセスの促進（Chain of Thought）

### 原則

複雑な推論タスクでは、モデルに段階的な思考プロセスを促すことで、精度が大幅に向上する。

### 詳細なガイドライン

#### 基本パターン

```
[タスク説明]

以下のステップで考えてください:
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]
...
最終的な解答: [解答]
```

#### 効果的なフレーズ

- 「ステップバイステップで考えてください」
- 「段階的に解決してください」
- 「まず...次に...最後に...」
- 「解答の前に、思考プロセスを示してください」

#### 思考プロセスの構造化

```
問題: [問題文]

思考プロセス:
1. 理解: [問題の理解と情報の整理]
2. 計画: [解決に必要なステップの特定]
3. 実行: [各ステップの実行]
4. 検証: [解答の妥当性の確認]

最終解答: [答え]
```

### 実践例

#### Before (思考プロセスなし)

```
以下のビジネスケースを分析してください:
[ケース説明]
```

#### After (Chain of Thought)

```
以下のビジネスケースを分析してください:
[ケース説明]

以下の手順で分析してください:

1. 状況の理解
   - 現在の状況を要約
   - 主要な関係者を特定
   - 制約条件を列挙

2. 問題の特定
   - 明示的な問題
   - 潜在的な問題
   - 根本原因

3. 選択肢の列挙
   - 各選択肢の説明
   - メリット
   - デメリット

4. 評価基準の設定
   - ROI
   - リスク
   - 実現可能性

5. 推奨案の決定
   - 選択した案とその理由
   - 実装ステップ
   - 期待される成果

最終的な推奨:
[明確な推奨案]
```

## 4. XMLタグの活用

### 原則

XMLタグで情報を構造化することで、モデルは複数の情報源を明確に区別でき、精度が向上する。

### 詳細なガイドライン

#### タグ命名規則

- 意味のある名前を使用（`<data>` より `<user_profile>` の方が良い）
- 小文字とアンダースコアを使用
- 簡潔で具体的な名前

#### 構造化パターン

```
<context>
  [背景情報]
</context>

<input>
  [処理対象のデータ]
</input>

<instructions>
  [指示]
</instructions>

<output_format>
  [期待する出力形式]
</output_format>
```

#### 複数データソースの区別

```
以下の2つのドキュメントを比較してください:

<document_a>
  <title>提案書A</title>
  <content>...</content>
</document_a>

<document_b>
  <title>提案書B</title>
  <content>...</content>
</document_b>

<comparison_criteria>
  - コスト
  - スケジュール
  - リスク
</comparison_criteria>

比較結果を<comparison></comparison>タグ内に出力してください。
```

### 実践例

#### コードレビューの構造化

```
<code>
  <file_path>app/services/user_service.py</file_path>
  <content>
    [コード]
  </content>
</code>

<review_criteria>
  <security>
    - 入力検証
    - 認証/認可
    - 暗号化
  </security>
  <performance>
    - データベースクエリ
    - キャッシング
    - アルゴリズムの効率
  </performance>
</review_criteria>

<output_format>
  <issue>
    <severity>[high/medium/low]</severity>
    <line_number>[行番号]</line_number>
    <description>[問題の説明]</description>
    <suggestion>[改善案]</suggestion>
  </issue>
</output_format>

レビュー結果を上記のフォーマットで<review_results></review_results>タグ内に出力してください。
```

## 5. ロール設定（System Prompts）

### 原則

モデルに特定の役割や専門性を与えることで、その分野に適したトーンと知識レベルで応答させる。

### 詳細なガイドライン

#### 効果的なロール設定の要素

1. **専門性レベル**: 「シニア」「10年以上の経験」
2. **専門分野**: 「Pythonエンジニア」「データサイエンティスト」
3. **評価視点**: 「セキュリティの観点から」
4. **コミュニケーションスタイル**: 「初心者にもわかるように」

#### パターン

```
あなたは[専門性レベル]の[専門分野]です。
[評価視点]から、[コミュニケーションスタイル]で、
以下のタスクを実行してください:

[タスク詳細]
```

### 実践例

#### 例1: コードレビュー

```
あなたは15年以上の経験を持つシニアセキュリティエンジニアです。
以下のWebアプリケーションコードを、OWASP Top 10の観点から
レビューし、セキュリティリスクを初心者エンジニアにもわかるように
説明してください。

[コード]
```

#### 例2: 技術文書レビュー

```
あなたはAPI設計とテクニカルライティングの専門家です。
以下のAPI仕様書を、以下の観点からレビューしてください:

1. 完全性: 必要な情報がすべて記載されているか
2. 明確性: 開発者が理解しやすいか
3. 一貫性: 命名規則やパターンが統一されているか
4. RESTful原則: REST APIのベストプラクティスに従っているか

[API仕様書]
```

#### 例3: ビジネス分析

```
あなたはMBA取得後、戦略コンサルティングファームで10年間の
経験を持つビジネスアナリストです。

以下のビジネスケースを、財務、オペレーション、市場の観点から
分析し、経営陣向けのサマリーを作成してください。
専門用語は使用せず、データに基づく具体的な推奨事項を含めてください。

[ビジネスケース]
```

## まとめ

これらのコアテクニックは、プロンプトエンジニアリングの基礎である。効果的なプロンプトは、これらのテクニックを適切に組み合わせることで作成できる。

### テクニック選択のガイドライン

- **明確な指示**: すべてのプロンプトで使用
- **Few-shot**: 分類、フォーマット変換、パターン認識タスク
- **Chain of Thought**: 複雑な推論、問題解決、分析タスク
- **XMLタグ**: 複数データソース、構造化された情報
- **ロール設定**: 専門的な知識、特定のトーンが必要な場合
